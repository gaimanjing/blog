# 《重构：改善既有代码的设计》读书笔记

> 任何一个傻瓜都能写出计算机可以理解的代码。惟有写出人类容易理解的代码，才是优秀的程序员。
>
> 代码被阅读和被修改的次数远远多于它被编写的次数。
> 
> 保持代码易读、易修改的关键，就是重构。

# 设计模式和重构
设计模式为重构提供了目标。

然而，确定目标只是问题的一部分而已，改造程序以达目标，是另一个难题。

# 什么是重构？
> 在不改变代码外在行为的前提下，对代码做出修改，以改进程序的内部结构。
> 
> 在代码写好之后改进它的设计。

### 先设计后编码
首先得有一个良好的设计，然后才开始编码。但是，随着时间流逝，人们不断修改代码，于是根据原先设计所得的系统，整体结构逐渐衰弱。代码质量慢慢沉沦，编码工作从严谨的工程堕落为胡砍乱劈的随性行为。
### 重构
重构正好相反。哪怕你手上有一个糟糕的设计，甚至是一堆混乱的代码，你也可以借助重构将它加工成设计良好的代码。重构的每个步骤都很简单，甚至简单过了头。但是，聚沙成塔，这些小小的修改累积起来就可以根本改善设计质量。
# 怎样重构
## 小重构
都可以在数分钟（之多一个小时）内完成。
## 大型重构
需要数月甚至数年的时间。
## 重构工具
* sonar 代码扫描
* xcode analyze, refactor
* lint

# 重构原则
### 两顶帽子
* 添加新功能
	* 不应该修改既有代码，只管添加新功能。
* 重构
	* 不能添加新功能，只管改进程序结构。

### 为何重构
* 改进软件设计
* 使软件更易被理解
* 帮助找到 bugs
* 提高编程速度

### 何时重构？
* 三次法则

第一次做某件事时只管去做；第二次做类似的事会产生反感，但无论如何还是做了；第三次再做类似的事，你就应该重构。

* 添加功能时一并重构
* 修补错误时一并重构
* 复审代码时一并重构


### 重构与性能
* 首先写出易理解的代码
* 出现性能问题时再做优化

# 代码的坏味道
* 重复的代码
* 过长函数
* 过大类
* 过长参数列
* 发散式变化
	* 
* 霰弹式修改
	* xx
* 依恋情结
	* xx
* 数据泥团
	* xx
* 基本类型偏执。。。
* switch 惊悚现身
* 平行继承体系。。。
* 冗赘类。。
* 夸夸其谈未来性。。
* 令人迷惑的暂时 field
* 过度耦合的消息链
* 中间转手人
* 狎昵关系
* 异曲同工的类
* 不完善的程序类库
* 纯稚的数据类
* 被拒绝的遗赠
* 过多的注释

# 构筑测试体系
# 重新组织你的函数
# 在对象之间搬移特性
# 重新组织数据
# 简化条件表达式
# 简化函数调用
# 处理继承关系
# 大型重构
## 梳理并分解继承体系
## 将过程化设计转化为对象设计
## 将领域和表述/显示分离
## 提炼继承体系
# 重构，复用与现实
## 为什么开发者不愿意重构他们的程序
* 不知道如何重构
* 如果这些利益是长远的，何必现在付出这些努力呢
* 代码重构是一项额外工作
* 重构可能破坏现有程序
# 集成
* 随时挑一个目标
* 没把握就停下来
* 学习原路返回
* 二重奏。和别人一起重构，可以收到更好的效果。

	

